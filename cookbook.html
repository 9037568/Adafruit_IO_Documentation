


<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Adafruit IO API Cookbook</title>

    <link href="images/favicon/favicon.ico" rel="icon" type="image/ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon/favicon-16x16.png">
    <link rel="manifest" href="images/favicon/site.webmanifest">
    <link rel="mask-icon" href="images/favicon/safari-pinned-tab.svg" color="#00A7E9">
    <meta name="msapplication-TileColor" content="#00A7E9">
    <meta name="theme-color" content="#000000">

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all_nosearch.js"></script>
  </head>

  <body class="cookbook" data-languages="[&quot;shell&quot;,&quot;cpp&quot;,&quot;python&quot;,&quot;python&quot;,&quot;ruby&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />

        <div class="lang-selector">
              <a href="#" data-language-name="shell">CURL</a>
              <a href="#" data-language-name="cpp">Arduino</a>
              <a href="#" data-language-name="python">Python</a>
              <a href="#" data-language-name="python">Circuitpython</a>
              <a href="#" data-language-name="ruby">Ruby</a>
        </div>


      <ul id="toc" class="toc-list-h1">
            <li>
              <a href="./" class="toc-h1 toc-link">Adafruit IO HTTP API</a>
            </li>
            <li>
              <a href="mqtt.html" class="toc-h1 toc-link">Adafruit IO MQTT API</a>
            </li>

          <li>
            <a href="#adafruit-io-api-cookbook" class="toc-h1 toc-link" data-title="Adafruit IO API Cookbook">
              Adafruit IO API Cookbook
                <span class="menu-arrow">
                  <svg width="18" height="18" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1171 960q0 13-10 23l-466 466q-10 10-23 10t-23-10l-50-50q-10-10-10-23t10-23l393-393-393-393q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l466 466q10 10 10 23z"/></svg>
                  <!-- <span>&gt;</span> -->
                </span>
            </a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#sending-and-sending-image-data-with-adafruit-io" class="toc-h2 toc-link" data-title="Sending and Sending image data with Adafruit IO">Sending and Sending image data with Adafruit IO</a>
                  </li>
                  <li>
                    <a href="#feed-identifiers" class="toc-h2 toc-link" data-title="Feed Identifiers">Feed Identifiers</a>
                  </li>
                  <li>
                    <a href="#webhook-receivers" class="toc-h2 toc-link" data-title="Webhook Receivers">Webhook Receivers</a>
                  </li>
                  <li>
                    <a href="#floating-point-data" class="toc-h2 toc-link" data-title="Floating Point Data">Floating Point Data</a>
                  </li>
                  <li>
                    <a href="#sending-and-storing-json" class="toc-h2 toc-link" data-title="Sending and Storing JSON">Sending and Storing JSON</a>
                  </li>
              </ul>
          </li>


      </ul>
        <ul class="toc-footer">
            <li><a href='https://io.adafruit.com'>Adafruit IO</a></li>
            <li><a href='https://io.adafruit.com/blog'>Adafruit IO News</a></li>
            <li><a href='https://io.adafruit.com/plus'>Adafruit IO Plus</a></li>
            <li><a href='https://io.adafruit.com/terms'>Adafruit IO ToS</a></li>
            <li><a href='https://io.adafruit.com/feedback'>Submit Feedback</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>

      <div class="content">
        <h1 id='adafruit-io-api-cookbook'>Adafruit IO API Cookbook</h1>
<p>This page contains a number of recipes related to Adafruit IO which have been found useful in the past. You can add and contribute to this file by filing an <code>issue</code> on the GitHub repository, or by editing this file and submitting a pull request.</p>
<h2 id='sending-and-sending-image-data-with-adafruit-io'>Sending and Sending image data with Adafruit IO</h2>
<p>Using an <em>Image Block</em>, you can automatically display a Base64 image data string on your dashboard by sending a Base64 image data string to an Adafruit IO feed.</p>

<p><em>Design Considerations:</em>
There are some important things to keep in mind when using this feature. Normal feeds are limited to 1KB of data, or about 1024 bytes, for publishing. Turning off feed history from the feed settings page allows publishing up to 100KB, or 102400 bytes, of data. Image conversion from binary to Base64 happens inside the browser, with no image pre-compression,  <em>and</em>  more importantly, conversion from binary to Base64 expands the size of the image data.</p>

<p>Youâ€™ll have to do your own testing to figure out what an appropriate image size and format (png, gif, or bmp) for you are. For example,  <a href="https://io.adafruit.com/blog/images/2016-12-14-power-switch.png">the .png image used for testing</a>  below has an on disk size of 68089 bytes, but a Base64 value of 90788 bytes, an expansion factor of about 150%, which is really close to the limit.</p>

<p><img src="https://io.adafruit.com/blog/images/2018-08-10-image-upload-size.png" alt="base64imagepreview" /></p>
<h2 id='feed-identifiers'>Feed Identifiers</h2>
<p>Names are for humans.</p>

<p>Keys are for computers.</p>

<p>You tell the computer the name, and it will tell you the key.</p>

<p>When  using  Adafruit  IO, you&#39;ll want to tell the client (the computer) the feed&#39;s <strong>key</strong> instead of the feed&#39;s <strong>name</strong>.</p>

<p>For more information about this topic:, visit <a href="https://learn.adafruit.com/naming-things-in-adafruit-io/introduction">the learn guide for feeds</a>
or the <a href="https://io.adafruit.com/blog/tips/2016/07/14/naming-feeds">IO Development blog post about naming feeds</a>.</p>
<h2 id='webhook-receivers'>Webhook Receivers</h2>
<p>Webhook receiver URLs give you a limited use, unique API address that you can send data to and have it appear in your Adafruit IO feed. Webhook URLs can be shared with anyone and used from anywhere on the web.</p>

<p>You can access a webhook by navigating to your feed and clicking the <em>Webhooks</em> button on the right-hand sidebar.</p>
<h3 id='raw-webhooks'>Raw Webhooks</h3>
<p>If you want to receive the whole contents of webhook events--for example, when receiving webhook notifications from a service like Slack or GitHub where you don&#39;t have control over the payload the service is sending--add <code>/raw</code> to the end of the Adafruit IO webhook URL that you share with the service.</p>
<h3 id='notify-webhooks'>Notify Webhooks</h3>
<p>If you only want to be notified that an event has happened, rather than have to handle all the data from an event--for example, if a service like GitHub is trying to send 7KB of JSON to your ESP8266--add <code>/notify</code> to the end of your Adafruit IO webhook URL. When data arrives, your feed will receive the message &quot;ping&quot;.</p>
<h2 id='floating-point-data'>Floating Point Data</h2>
<p>If you&#39;re sending <code>3.1415</code> and only want to send <code>3.14</code> - reduce the value to the desired amount of precision in your code. You can round (up or down) or truncate this value to get it in the format you want Adafruit IO to display.</p>
<h2 id='sending-and-storing-json'>Sending and Storing JSON</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">22.587</span><span class="p">,</span><span class="w">
  </span><span class="s2">"lat"</span><span class="p">:</span><span class="w"> </span><span class="mf">38.1123</span><span class="p">,</span><span class="w">
  </span><span class="s2">"lon"</span><span class="p">:</span><span class="w"> </span><span class="mf">-91.2325</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ele"</span><span class="p">:</span><span class="w"> </span><span class="mi">112</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Because Adafruit IO supports additional features beyond a basic MQTT brokering service, such as location tagging for data points, the service supports data in the JSON format described in the <a href="/#create-data">HTTP create data API description</a>.</p>

<p>This lets us store the individual value, <code>22.587</code>, and data about the value: its latitude, longitude, and elevation. Data about the data is &quot;metadata&quot;!</p>

<p>But what happens when the value you want to send is itself JSON? Good news! There are a few solutions available to you in that situation.</p>
<h3 id='double-encoded-json-strings'>Double encoded JSON strings</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
  <span class="s2">"value"</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="s2">"sensor-1"</span><span class="p">:</span><span class="mf">22.587</span><span class="p">,</span><span class="s2">"sensor-2"</span><span class="p">:</span><span class="mf">13.182</span><span class="p">})</span>
<span class="p">})</span>
</code></pre>
<p><strong>The safest way to can send JSON data as a value</strong> is to &quot;double encode&quot; it before sending, in which case IO will treat it as a raw string. If you&#39;re using something like javascript&#39;s <code>JSON.stringify</code> function or Ruby&#39;s <code>JSON.generate</code>, double encoding means passing the result of <code>JSON.stringify</code> through <code>JSON.stringify</code> a second time</p>

<p>The double encoded JSON string can be sent directly through Adafruit IO without interference from our processing system, because the processing system will not interpret it as JSON. In your receiving code, because the value passed through includes surrounding double quotes, you have to call your parse function twice to restore the JSON object.</p>

<p><code>JSON.parse(JSON.parse(input))</code></p>
<h3 id='io-formatted-json'>IO formatted JSON</h3><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"sensor-1"</span><span class="p">:</span><span class="mf">22.587</span><span class="p">,</span><span class="s2">"sensor-2"</span><span class="p">:</span><span class="mf">13.182</span><span class="p">},</span><span class="w">
  </span><span class="s2">"lat"</span><span class="p">:</span><span class="w"> </span><span class="mf">38.1123</span><span class="p">,</span><span class="w">
  </span><span class="s2">"lon"</span><span class="p">:</span><span class="w"> </span><span class="mf">-91.2325</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ele"</span><span class="p">:</span><span class="w"> </span><span class="mi">112</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The simplest way to send JSON data to Adafruit IO is include it directly in the datum formatted record you send to IO. For example, if instead of 22.587, I wanted to send something like, {&quot;sensor-1&quot;:22.587,&quot;sensor-2&quot;:13.182}, the &quot;wrapped&quot; version would look like the value on the right.</p>

<p>It&#39;s worth noting that because Adafruit IO parses the entire JSON object that you send it, any valid JSON will be parsed and when it is stored in our system and forwarded to any subscribers, it will be regenerated. The significance of that is that if you publish JSON data with whitespace, it will be stored and republished without whitespace, because our generator produces the most compact JSON format possible.</p>
<h3 id='non-io-formatted-json'>Non-IO formatted JSON</h3><pre class="highlight plaintext"><code>curl -H "Content-Type: application/json" \
    -H "X-AIO-Key: toomanysecrets" \
    --data '{"sensor-1":22.587,"sensor-2":13.182}' \
    https://io.adafruit.com/api/v2/username/feeds/feed-key/data

</code></pre>
<p>Another way you can send raw JSON data is to just send it. If Adafruit IO doesn&#39;t find a &quot;value&quot; key in the JSON object you send, it will treat the whole blob as plain text and store and forward the data. That means with our example JSON object, sending the string <code>{&quot;sensor-1&quot;:22.587,&quot;sensor-2&quot;:13.182}</code> will result in <code>{&quot;sensor-1&quot;:22.587,&quot;sensor-2&quot;:13.182}</code> being stored in IO and sent to MQTT subscribers.</p>

<p><strong>NOTE:</strong> This solution is the riskiest, because if your JSON blob includes the key named <code>value</code>, then IO will interpret <em>that</em> as the value you want to store and ignore all the other keys.</p>
<h3 id='that-39-s-not-json-at-all'>That&#39;s not JSON at all!</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">btoa</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="s2">"something"</span><span class="p">:</span> <span class="s2">"here"</span> <span class="p">}))</span>
<span class="c1">// "eyJzb21ldGhpbmciOiJoZXJlIn0="</span>
<span class="nx">atob</span><span class="p">(</span><span class="s2">"eyJzb21ldGhpbmciOiJoZXJlIn0="</span><span class="p">)</span>
<span class="c1">// {"something":"here"}</span>
</code></pre>
<p>If you want to be absolutely sure that Adafruit IO will not interfere with the data you&#39;re sending, encode it as a <a href="https://en.wikipedia.org/wiki/Base64">Base64</a> string first.</p>

<p>This solution is also ideal if you want to store or send binary data with Adafruit IO. You won&#39;t get to see any pretty charts, but your data will remain exactly the way you left it.</p>

      </div>

      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">CURL</a>
                <a href="#" data-language-name="cpp">Arduino</a>
                <a href="#" data-language-name="python">Python</a>
                <a href="#" data-language-name="python">Circuitpython</a>
                <a href="#" data-language-name="ruby">Ruby</a>
          </div>
      </div>
    </div>
  </body>
</html>
